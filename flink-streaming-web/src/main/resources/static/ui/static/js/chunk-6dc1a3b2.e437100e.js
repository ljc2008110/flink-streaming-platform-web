(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6dc1a3b2"],{"295e":function(e,t,a){"use strict";a.d(t,"b",(function(){return s})),a.d(t,"c",(function(){return i})),a.d(t,"a",(function(){return c}));var r=a("b775"),o=a("4328"),n=a.n(o);function s(e){var t=this;return i(e).then((function(e){var a=e.code,r=e.data,o=e.success,n=e.message;return"200"===a&&o?r&&r.data?r.data[0]:{}:(t.$message({type:"error",message:n||"请求数据异常！"}),void console.log(n))})).catch((function(e){t.$message({type:"error",message:"请求异常！"}),console.log(e)}))}function i(e){return Object(r["a"])({url:"/querySavePointList10",method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:[function(e){return n.a.stringify(e)}],data:{taskid:e}})}function c(e,t){return Object(r["a"])({url:"/addSavepoint",method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:[function(e){return n.a.stringify(e)}],data:{jobConfigId:e,savepointPath:t}})}},a3ee:function(e,t,a){"use strict";a("fc8c")},b199:function(e,t,a){"use strict";a.d(t,"j",(function(){return s})),a.d(t,"h",(function(){return i})),a.d(t,"m",(function(){return c})),a.d(t,"k",(function(){return l})),a.d(t,"c",(function(){return u})),a.d(t,"o",(function(){return f})),a.d(t,"p",(function(){return m})),a.d(t,"n",(function(){return p})),a.d(t,"l",(function(){return d})),a.d(t,"d",(function(){return g})),a.d(t,"e",(function(){return h})),a.d(t,"b",(function(){return b})),a.d(t,"a",(function(){return y})),a.d(t,"f",(function(){return v})),a.d(t,"i",(function(){return k})),a.d(t,"g",(function(){return C}));var r=a("b775"),o=a("4328"),n=a.n(o);a("295e");function s(e,t,a,o,s,i,c){return Object(r["a"])({url:"/listTask",method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:[function(e){return n.a.stringify(e)}],data:{pageNum:e,pageSize:t,jobName:a,jobId:o,jobType:s,status:i,open:c}})}function i(e){return Object(r["a"])({url:"/getTask",method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:[function(e){return n.a.stringify(e)}],data:{id:e}})}function c(e,t){return Object(r["a"])({url:"/setAutoRestore",method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:[function(e){return n.a.stringify(e)}],data:{id:e,autoRestore:t}})}function l(e){return Object(r["a"])({url:"/open",method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:[function(e){return n.a.stringify(e)}],data:{id:e}})}function u(e){return Object(r["a"])({url:"/close",method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:[function(e){return n.a.stringify(e)}],data:{id:e}})}function f(e){return Object(r["a"])({url:"/start",method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:[function(e){return n.a.stringify(e)}],data:{id:e}})}function m(e,t){return Object(r["a"])({url:"/stop",method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:[function(e){return n.a.stringify(e)}],data:{id:e,isSavePoint:t}})}function p(e,t){return Object(r["a"])({url:"/start",method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:[function(e){return n.a.stringify(e)}],data:{id:e,savepointId:t}})}function d(e){return Object(r["a"])({url:"/savepoint",method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:[function(e){return n.a.stringify(e)}],data:{id:e}})}function g(e){return Object(r["a"])({url:"/copyConfig",method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:[function(e){return n.a.stringify(e)}],data:{id:e}})}function h(e){return Object(r["a"])({url:"/delete",method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:[function(e){return n.a.stringify(e)}],data:{id:e}})}function b(e){return Object(r["a"])({url:"/checkfSql",method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:[function(e){return n.a.stringify(e)}],data:{flinkSql:e}})}function y(e){return Object(r["a"])({url:"/addConfig",method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:[function(e){return n.a.stringify(e)}],data:e})}function v(e){return Object(r["a"])({url:"/editConfig",method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:[function(e){return n.a.stringify(e)}],data:e})}function k(e){return Object(r["a"])({url:"/jobConfigHistoryPage",method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:[function(e){return n.a.stringify(e)}],data:e})}function C(e){switch(e){case-2:return"未知";case-1:return"失败";case 0:return"停止";case 1:return"运行中";case 2:return"启动中";case 3:return"提交成功";case 95:return"退出中";case 96:return"退出中";case 97:return"已退出";case 98:return"已完成";case 99:return"重启中";case 100:return"已挂起";case"UNKNOWN":return"未知";case"FAIL":return"失败";case"STOP":return"停止";case"RUN":return"运行中";case"STARTING":return"启动中";case"SUCCESS":return"提交成功";case"CANCELING":return"退出中";case"FAILING":return"退出中";case"CANCELED":return"已退出";case"FINISHED":return"已完成";case"RESTARTING":return"重启中";case"SUSPENDED":return"已挂起";default:return e+"　"}}},ecb9:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],class:"fl-sqltask-container fl-task-edit"+(e.isReadOnly?" fl-task-edit__isRead":"")},[a("el-tooltip",{staticClass:"item",staticStyle:{"padding-top":"15px"},attrs:{effect:"dark",content:"返回",placement:"right"}},[a("i",{ref:"backbutton",staticClass:"el-icon-d-arrow-left fl-back",on:{click:function(t){return e.handleBack()}}})]),a("el-form",{ref:"taskform",attrs:{model:e.form,rules:e.rules,disabled:e.isReadOnly,"label-width":"80px",size:"small"}},["history"===e.params.flag?a("el-row",[a("el-col",{attrs:{span:10}},[a("el-form-item",{attrs:{label:"版本号",prop:"version"}},[a("el-input",{model:{value:e.form.version,callback:function(t){e.$set(e.form,"version",t)},expression:"form.version"}})],1)],1),a("el-col",{attrs:{span:14}},[a("el-form-item",{attrs:{label:"备份时间",prop:"createTime","label-width":"100px"}},[a("el-input",{attrs:{value:e.formatDateTime(e.form.createTime)}})],1)],1)],1):e._e(),a("el-row",[a("el-col",{attrs:{span:10}},[a("el-form-item",{attrs:{label:"任务编号",prop:"id"}},[a("el-input",{attrs:{placeholder:"任务编号",disabled:""},model:{value:e.form.id,callback:function(t){e.$set(e.form,"id",t)},expression:"form.id"}})],1)],1),a("el-col",{attrs:{span:14}},[a("el-form-item",{attrs:{label:"运行参数",prop:"flinkRunConfig",required:"YARN_PER"===this.form.deployModeEnum,"label-width":"100px"}},[a("span",{attrs:{slot:"label"},slot:"label"},[e._v("运行参数 "),a("el-popover",{attrs:{placement:"right",trigger:"hover"}},["LOCAL"===e.form.deployModeEnum?[e._v(" 在LOCAL模式下无需配置 ")]:"YARN_PER"===e.form.deployModeEnum?[e._v(" 参数（和Flink官方保持一致）但是只支持 -yD -p -yjm -yn -ytm -ys -yqu(必选)"),a("br"),e._v(" -ys slot个数。"),a("br"),e._v(" -yn task manager 数量。"),a("br"),e._v(" -yjm job manager 的堆内存大小。"),a("br"),e._v(" -ytm task manager 的堆内存大小。"),a("br"),e._v(" -yqu yarn队列明"),a("br"),e._v(" -p 并行度"),a("br"),e._v(" -yD 如:-yD taskmanager.heap.mb=518"),a("br"),e._v(" 详见Flink官方文档"),a("br"),e._v(" 如： -yqu flink -yjm 1024m -ytm 2048m -p 1 -ys 1 ")]:"STANDALONE"===e.form.deployModeEnum?[e._v(" -d,--detached 如果存在，则以分离模式运行作业"),a("br"),e._v(" -p,--parallelism <parallelism> 运行程序的并行性。用于覆盖配置中指定的默认值的可选标志"),a("br"),e._v(" -s,--fromSavepoint <savepointPath> 从savepointPath中恢复任务(如：-s hdfs:///flink/savepoint-1537)"),a("br"),e._v(" 其他运行参数可通过 flink -h查看 ")]:[e._v(" 请选择运行模式 ")],a("i",{staticClass:"el-icon-info",attrs:{slot:"reference"},slot:"reference"})],2)],1),a("el-input",{attrs:{placeholder:"如yarn模式 -yjm 1024m -ytm 1024m -p 1 -yqu streaming"},model:{value:e.form.flinkRunConfig,callback:function(t){e.$set(e.form,"flinkRunConfig",t)},expression:"form.flinkRunConfig"}})],1)],1)],1),a("el-row",[a("el-col",{attrs:{span:10}},[a("el-form-item",{attrs:{label:"任务名称",prop:"jobName"}},[a("el-input",{attrs:{placeholder:"请输入任务名称"},model:{value:e.form.jobName,callback:function(t){e.$set(e.form,"jobName",t)},expression:"form.jobName"}})],1)],1),a("el-col",{attrs:{span:14}},[a("el-form-item",{attrs:{label:"状态保存",prop:"flinkCheckpointConfig","label-width":"100px"}},[a("span",{attrs:{slot:"label"},slot:"label"},[e._v("状态保存 "),a("el-popover",{attrs:{placement:"bottom-start",trigger:"hover"}},[e._v(" 不填默认不开启checkpoint机制，支持如下参数："),a("br"),e._v(" checkpointInterval：整数，默认每60s保存一次checkpoint，单位毫秒"),a("br"),e._v(" checkpointingMode：EXACTLY_ONCE 或者 AT_LEAST_ONCE，一致性模式 默认EXACTLY_ONCE，单位字符"),a("br"),e._v(" checkpointTimeout：6000，默认超时10 minutes，单位毫秒"),a("br"),e._v(" checkpointDir：保存地址 如 hdfs://hcluster/flink/checkpoints/ 注意目录权限"),a("br"),e._v(" tolerableCheckpointFailureNumber：1，设置失败次数 默认一次"),a("br"),e._v(" asynchronousSnapshots：true 或者 false，是否异步"),a("br"),e._v(" externalizedCheckpointCleanup：DELETE_ON_CANCELLATION或者RETAIN_ON_CANCELLATION，作业取消后检查点是否删除（可不填）"),a("br"),e._v(" stateBackendType：0 或者 1 或者 2，默认1 后端状态 0:MemoryStateBackend 1: FsStateBackend 2:RocksDBStateBackend"),a("br"),e._v(" enableIncremental：true 或者 false，是否采用增量 只有在 stateBackendType 2模式下才有效果 即RocksDBStateBackend"),a("br"),e._v(" 如： -stateBackendType 2 -enableIncremental true -checkpointInterval 900000 -checkpointDir hdfs:///flink/checkpoints/hearbeat_to_hive "),a("i",{staticClass:"el-icon-info",attrs:{slot:"reference"},slot:"reference"})])],1),a("el-input",{attrs:{placeholder:"Checkpoint配置，如：-checkpointDir hdfs:///flink/checkpoint/",disabled:!(0===this.form.jobType)},model:{value:e.form.flinkCheckpointConfig,callback:function(t){e.$set(e.form,"flinkCheckpointConfig",t)},expression:"form.flinkCheckpointConfig"}})],1)],1)],1),a("el-row",[a("el-col",{attrs:{span:10}},[a("el-row",[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"任务描述",prop:"jobDesc"}},[a("el-input",{attrs:{placeholder:"请输入任务描述"},model:{value:e.form.jobDesc,callback:function(t){e.$set(e.form,"jobDesc",t)},expression:"form.jobDesc"}})],1)],1)],1),a("el-row",[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"运行模式",prop:"deployModeEnum"}},[a("el-select",{staticClass:"fl-form-item",attrs:{placeholder:"请选择运行模式"},model:{value:e.form.deployModeEnum,callback:function(t){e.$set(e.form,"deployModeEnum",t)},expression:"form.deployModeEnum"}},[a("el-option",{attrs:{label:"Local Cluster",value:"LOCAL"}}),a("el-option",{attrs:{label:"Standalone Cluster",value:"STANDALONE"}}),a("el-option",{attrs:{label:"YARN PER",value:"YARN_PER"}})],1)],1)],1)],1)],1),a("el-col",{attrs:{span:14}},[a("el-row",[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"三方JAR",prop:"extJarPath","label-width":"100px"}},[a("span",{attrs:{slot:"label"},slot:"label"},[e._v("三方JAR "),a("el-popover",{attrs:{placement:"right",trigger:"hover"}},[e._v(" 自定义udf、连接器等jar地址，多个请使用换行(如 http://xxxx.com/udf.jar) 目前只支持http "),a("i",{staticClass:"el-icon-info",attrs:{slot:"reference"},slot:"reference"})])],1),a("el-input",{staticClass:"fl-jar-input",attrs:{type:"textarea",resize:"none",placeholder:"自定义udf、连接器等jar地址，多个请使用换行(如 http://xxxx.com/udf.jar) 目前只支持http"},model:{value:e.form.extJarPath,callback:function(t){e.$set(e.form,"extJarPath",t)},expression:"form.extJarPath"}})],1)],1)],1)],1)],1),a("el-row",{staticClass:"fl-alarm-row"},[a("el-col",{attrs:{xs:16,sm:16,md:14,lg:11}},[a("el-form-item",{staticClass:"el-form--inline",attrs:{label:"告警配置",prop:"alarmTypes"}},[a("el-checkbox-group",{model:{value:e.form.alarmTypes,callback:function(t){e.$set(e.form,"alarmTypes",t)},expression:"form.alarmTypes"}},[a("el-checkbox",{attrs:{label:1}},[e._v("钉钉告警")]),a("el-checkbox",{attrs:{label:2}},[e._v("Http回调告警")]),a("el-checkbox",{attrs:{label:3}},[e._v("退出自动拉起")])],1)],1)],1),a("el-col",{attrs:{xs:4,sm:4,md:5,lg:3}},[a("el-form-item",{attrs:{label:"开启状态"}},[a("el-switch",{attrs:{"active-value":1,"inactive-value":0,"active-color":"#13ce66"},on:{change:function(t){return e.changeIsOpen(t)}},model:{value:e.form.isOpen,callback:function(t){e.$set(e.form,"isOpen",t)},expression:"form.isOpen"}})],1)],1),a("el-col",{staticClass:"el-form-inline",attrs:{xs:4,sm:4,md:5,lg:3}},[a("el-form-item",{attrs:{label:"SP恢复",title:"从SavePoint恢复启动"}},[a("el-switch",{attrs:{"active-value":1,"inactive-value":0,"active-color":"#13ce66"},on:{change:function(t){return e.changeAutoRestore(t)}},model:{value:e.form.autoRestore,callback:function(t){e.$set(e.form,"autoRestore",t)},expression:"form.autoRestore"}})],1)],1),a("el-col",{attrs:{xs:4,sm:4,md:5,lg:2}},[a("el-form-item",{attrs:{label:"运行状态",prop:"status"}},[-2===e.form.status||"UNKNOWN"===e.form.status?a("el-tag",{attrs:{type:"info",size:"mini"}},[e._v(e._s(e.getStatusDesc(e.form.status)))]):-1===e.form.status||"FAIL"===e.form.status?a("el-tag",{attrs:{type:"danger",size:"mini"}},[e._v(e._s(e.getStatusDesc(e.form.status)))]):0===e.form.status||"STOP"===e.form.status?a("el-tag",{attrs:{type:"warning",size:"mini"}},[e._v(e._s(e.getStatusDesc(e.form.status)))]):1===e.form.status||"RUN"===e.form.status?a("el-tag",{attrs:{type:"success",size:"mini"}},[e._v(e._s(e.getStatusDesc(e.form.status)))]):2===e.form.status||"STARTING"===e.form.status?a("el-tag",{attrs:{size:"mini"}},[e._v(e._s(e.getStatusDesc(e.form.status)))]):3===e.form.status||"SUCCESS"===e.form.status?a("el-tag",{attrs:{type:"success",size:"mini"}},[e._v(e._s(e.getStatusDesc(e.form.status)))]):a("el-tag",{attrs:{type:"info",size:"mini"}},[e._v(e._s(e.getStatusDesc(e.form.status)))])],1)],1),a("el-col",{attrs:{xs:4,sm:4,md:5,lg:5}},[a("el-form-item",{attrs:{label:""}},[""!==e.form.lastRunLogId?a("el-button",{attrs:{type:"info"},on:{click:function(t){return e.toLogDetail()}}},[e._v("日志")]):e._e(),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.startTaskWithOrOutSP()}}},[e._v("启动")])],1)],1)],1),a("el-row",{class:e.getTaskClass()},[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"SQL脚本",prop:"flinkSql"}},[a("codemirror",{ref:"cm",staticClass:"fl-codemirror",attrs:{value:e.form.flinkSql,options:e.cmOptions},on:{changes:e.doSqlChange}})],1)],1)],1),!1===e.isReadOnly?a("el-row",{staticClass:"fl-button-row"},[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:""}},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitTask()}}},[e._v("提 交")]),a("el-button",{attrs:{type:"primary",plain:""},on:{click:function(t){return e.formatSQL()}}},[e._v("格式化代码")]),a("el-button",{attrs:{type:"primary",plain:""},on:{click:function(t){return e.checkSQL()}}},[e._v("SQL预校验")]),a("el-popover",{attrs:{placement:"top-start",trigger:"hover"}},[e._v(" SQL预校验"),a("br"),e._v(" 备注：只能校验单个sql语法正确与否, 不能校验上下文之间关系，如：这张表是否存在、数据类型是否正确等无法校验"),a("br"),e._v(" 总之不能完全保证运行的时候sql没有异常，只是能校验出一些语法错误 "),a("i",{staticClass:"el-icon-info",attrs:{slot:"reference"},slot:"reference"})]),a("el-button",{attrs:{type:"info"},on:{click:function(t){return e.handleBack()}}},[e._v("返回")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.refreshTask(e.form.id)}}},[e._v("刷新")]),a("el-button",{staticStyle:{color:"#13ce66"},attrs:{type:"text"}},[e._v(e._s(e.form.checkSQLResult))])],1)],1)],1):e._e()],1)],1)},o=[],n=(a("498a"),a("ac1f"),a("5319"),a("99af"),a("a15b"),a("8f94")),s=(a("a7be"),a("f6b6"),a("9b74"),a("9603"),a("ffda"),a("991c"),a("8c33"),a("31c5"),a("ba14"),a("b199")),i=a("295e"),c={name:"SQLTask",components:{codemirror:n["codemirror"]},data:function(){var e=this,t=function(t,a,r){return"YARN_PER"!==e.form.deployModeEnum||a&&""!==a.trim()?r():r(new Error("请选择运行参数"))};return{loading:!1,params:{flag:"",data:{},context:""},query:{id:"",flag:""},isReadOnly:!1,form:{id:"",jobName:"",jobDesc:"",jobType:0,deployModeEnum:"",flinkRunConfig:"",flinkCheckpointConfig:"",flinkSql:"",alarmTypes:[],extJarPath:"",isOpen:"",status:"",checkSQLResult:"",version:"",createTime:"",autoRestore:""},rules:{jobName:[{required:!0,message:"请输入任务名称",trigger:"blur"}],jobDesc:[{required:!0,message:"请输入任务描述",trigger:"blur"}],deployModeEnum:[{required:!0,message:"请选择运行模式",trigger:"blur"}],flinkSql:[{required:!0,message:"请输入SQL脚本",trigger:"blur"}],flinkRunConfig:[{validator:t,trigger:"blur"}]},cmOptions:{value:"",mode:"text/x-mysql",theme:"mbo",readOnly:!1,tabSize:4,line:!0,lineNumbers:!0,indentUnit:4,matchBrackets:!0,extraKeys:{Ctrl:"autocomplete"},hintOptions:{completeSingle:!1,tables:{"table.dynamic-table-options.enabled":[],"table.sql-dialect":[],"table.local-time-zone":[],"table.generated-code.max-length":[],"table.exec":["state.ttl","source.idle-timeout","source.cdc-events-duplicate","window-agg.buffer-size-limit","source.cdc-events-duplicate","mini-batch.enabled","mini-batch.allow-latency","mini-batch.enabled","mini-batch.allow-latency","mini-batch.size","sink.not-null-enforcer","resource.default-parallelism","async-lookup.buffer-capacity","async-lookup.timeout"],"table.optimizer":["distinct-agg.split.enabled","distinct-agg.split.bucket-num","agg-phase-strategy","reuse-sub-plan-enabled","reuse-source-enabled","source.predicate-pushdown-enabled","join-reorder-enabled"]}}}}},mounted:function(){var e=this.$route.query;this.params.flag=e.flag,this.params.jobConfigId=e.id,this.loading=!0,this.refreshTask(e.id),this.isReadOnly=!("create"===e.flag||"update"===e.flag),this.cmOptions.readOnly=this.isReadOnly,this.$refs.cm.codemirror.on("keypress",(function(e){e.showHint()}))},methods:{toLogDetail:function(){this.$router.replace({name:"ViewTaskLogDetail",params:{flag:"sqltask",data:{id:this.form.lastRunLogId,flag:this.params.flag,jobConfigId:this.params.jobConfigId}},query:{id:this.params.jobConfigId,flag:this.params.flag}})},refreshTask:function(e){var t=this;this.loading=!0,Object(s["h"])(e).then((function(e){t.loading=!1;var a=e.code,r=e.success,o=e.message;if("200"===a&&r){var n=e.data;t.params.data=n,t.form.id=n.id?n.id:"",t.form.jobName=n.jobName?n.jobName:"",t.form.jobDesc=n.jobDesc?n.jobDesc:"",t.form.jobType=n.jobTypeEnum?t.getJobType(n.jobTypeEnum):0,t.form.deployModeEnum=n.deployMode?n.deployMode:"",t.form.flinkRunConfig=n.flinkRunConfig?n.flinkRunConfig:"",t.form.flinkCheckpointConfig=n.flinkCheckpointConfig?n.flinkCheckpointConfig:"",t.form.flinkSql=n.flinkSql?n.flinkSql:"",t.form.alarmTypes=n.alarmTypes?n.alarmTypes:[],t.form.extJarPath=n.extJarPath?n.extJarPath:"",t.form.isOpen=n.isOpen?n.isOpen:"",t.form.status=""!==n.status?n.status:"",t.form.version=n.version?n.version:"",t.form.createTime=n.createTime?n.createTime:"",t.form.autoRestore=n.autoRestore?n.autoRestore:"",t.form.lastRunLogId=n.lastRunLogId?n.lastRunLogId:""}else t.$message({type:"error",message:o||"请求数据异常！"})})).catch((function(e){console.log(e)}))},handleBack:function(){var e="history"===this.params.flag?"HistoryTask":"FlinkTaskManage";this.$router.replace({name:e,params:this.params.context})},startTaskWithOrOutSP:function(){var e=this;this.form.isOpen?Object(i["b"])(this.form.id).then((function(t){if(!t||!t.id)return console.log("没有找到savepoint，无法恢复启动，将重新启动！"),void e.startTaskWithoutSavepoint(e.form.id);if(e.form.autoRestore)e.startTaskWithSavePoint(t);else{var a=e.form.id,r=t.savepointPath,o=t.backupTime;e.$confirm("未开启从SP恢复但存在savepoint备份[备份地址：".concat(r,"，备份时间：").concat(o,"]！确定重新启动吗？"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.loading=!0,e.startTaskWithoutSavepoint(a)})).catch((function(e){console.log(e)}))}})).catch((function(e){console.log(e)})):this.$message({type:"error",message:"任务状态未开启，无法恢复启动！请先开启。"})},startTaskWithoutSavepoint:function(e){var t=this;Object(s["o"])(e).then((function(a){t.loading=!1;var r=a.code,o=a.success,n=a.message;"200"===r&&o?(t.$message({type:"info",message:"正在启动["+t.form.jobName+"]，稍后请刷新！"}),t.refreshTask(e)):t.$message({type:"error",message:n||"请求数据异常！"})})).catch((function(e){t.loading=!1,t.$message({type:"error",message:"请求异常！"}),console.log(e)}))},startTaskWithSavePoint:function(e){var t=this;if(!this.form.autoRestore||e&&e.id){if(e&&e.id){var a=this.form.id,r=e.id,o=e.savepointPath,n=e.backupTime;this.$confirm("是否恢复任务[备份地址：".concat(o,"，备份时间：").concat(n,"]！"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.loading=!0,Object(s["n"])(a,r).then((function(e){t.loading=!1;var r=e.code,s=e.success,i=e.message;if("200"!==r||!s)return t.$message({type:"error",message:i||"请求数据异常！"}),void console.log(i);t.$message({type:"info",message:"正在恢复任务[备份地址：".concat(o,"，备份时间：").concat(n,"]，稍后请刷新！")}),t.refreshTask(a)})).catch((function(e){t.loading=!1,t.$message({type:"error",message:"请求异常！"}),console.log(e)}))})).catch((function(e){console.log(e)}))}}else this.$message({type:"error",message:"没有找到savepoint，无法恢复启动！"})},changeAutoRestore:function(e){var t=this,a=1===e?"开启":"关闭",r=this.params.data,o=r.id,n=r.jobName,i=r.autoRestore;this.$confirm("是否".concat(a,"[").concat(n,"]从savepoint恢复启动吗？"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.loading=!0;var r=1^i;Object(s["m"])(o,r).then((function(r){t.loading=!1;var s=r.code,i=r.success,c=r.message;if("200"!==s||!i)return t.form.autoRestore=1===e?0:1,void t.$message({type:"error",message:c||"请求数据异常！"});t.$message({type:"success",message:"".concat(a,"[").concat(n,"]从savepoint恢复启动方式，执行成功！")}),t.refreshTask(o)})).catch((function(a){t.loading=!1,t.form.autoRestore=1===e?0:1,t.$message({type:"error",message:"请求异常！"}),console.log(a)}))})).catch((function(a){t.loading=!1,t.form.autoRestore=1===e?0:1}))},changeIsOpen:function(e){var t=this,a=1===e?"开启":"关闭",r=this.params.data,o=r.id,n=r.jobName;this.$confirm("是否".concat(a,"[").concat(n,"]"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){1===e?(t.loading=!0,Object(s["k"])(o).then((function(a){t.loading=!1;var r=a.code,o=a.success,s=a.message;if("200"!==r||!o)return t.form.isOpen=1===e?0:1,void t.$message({type:"error",message:s||"请求数据异常！"});t.$message({type:"success",message:"开启[".concat(n,"]成功！")})})).catch((function(a){t.loading=!1,t.form.isOpen=1===e?0:1,t.$message({type:"error",message:"请求异常！"}),console.log(a)}))):0===e&&(t.loading=!0,Object(s["c"])(o).then((function(a){t.loading=!1;var r=a.code,o=a.success,s=a.message;if("200"!==r||!o)return t.form.isOpen=1===e?0:1,void t.$message({type:"error",message:s||"请求数据异常！"});t.$message({type:"success",message:"关闭[".concat(n,"]成功！")})})).catch((function(a){t.loading=!1,t.form.isOpen=1===e?0:1,t.$message({type:"error",message:"请求异常！"}),console.log(a)})))})).catch((function(a){t.form.isOpen=1===e?0:1}))},submitTask:function(){var e=this;this.form.flinkSql=this.$refs.cm.codemirror.getValue(),this.$refs.taskform.validate((function(t){if(!t)return!1;var a=e.form.jobName,r=e.form.alarmTypes.join(","),o={id:e.form.id,jobName:a,jobDesc:e.form.jobDesc,deployMode:e.form.deployModeEnum,flinkRunConfig:e.form.flinkRunConfig,flinkCheckpointConfig:e.form.flinkCheckpointConfig,flinkSql:e.form.flinkSql,jobType:e.form.jobType,alarmTypes:r,extJarPath:e.form.extJarPath};o.id||"create"!==e.params.flag?o.id&&"update"===e.params.flag&&Object(s["f"])(o).then((function(t){e.loading=!1;var r=t.code,o=t.success,n=t.message;"200"===r&&o?e.$message({type:"success",message:"修改任务[".concat(a,"]成功！")}):e.$message({type:"error",message:n||"请求数据异常！"})})).catch((function(t){e.loading=!1,e.$message({type:"error",message:"请求异常！"}),console.log(t)})):Object(s["a"])(o).then((function(t){e.loading=!1;var r=t.code,o=t.success,n=t.message;"200"===r&&o?(e.$message({type:"success",message:"新增任务[".concat(a,"]成功！")}),e.$refs.backbutton.click()):e.$message({type:"error",message:n||"请求数据异常！"})})).catch((function(t){e.loading=!1,e.$message({type:"error",message:"请求异常！"}),console.log(t)}))}))},formatSQL:function(){var e=this.$refs.cm.codemirror;n["CodeMirror"].commands["selectAll"](e);var t={from:e.getCursor(!0),to:e.getCursor(!1)};e.autoFormatRange(t.from,t.to)},checkSQL:function(){var e=this;this.loading=!0;var t=this.$refs.cm.codemirror.getValue();Object(s["b"])(t).then((function(t){e.loading=!1;var a=t.code,r=t.success,o=t.message;"200"===a&&r?(e.form.checkSQLResult="校验SQL通过!",e.$message({type:"success",message:"校验SQL通过！"})):e.$message({type:"error",message:o||"请求数据异常！"})})).catch((function(t){e.loading=!1,e.$message({type:"error",message:"请求异常！"}),console.log(t)}))},doSqlChange:function(e){this.form.checkSQLResult=""},getTaskClass:function(){return"history"===this.params.flag?"fl-task-edit__history":this.isReadOnly?"fl-cm-row__isRead":""},formatDateTime:function(e){return this.dayjs(e).format("YYYY-MM-DD HH:mm:ss")},getJobType:function(e){switch(e){case"SQL_STREAMING":return 0;case"SQL_BATCH":return 2;case"JAR":return 1;default:return e}},getStatusDesc:function(e){return Object(s["g"])(e)}}},l=c,u=(a("a3ee"),a("2877")),f=Object(u["a"])(l,r,o,!1,null,"062c261d",null);t["default"]=f.exports},fc8c:function(e,t,a){}}]);